<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Каталог шин</title>
<style>
body{font-family:Arial;background:#f6f6f6;margin:0}
header{background:#111;color:#fff;padding:12px;text-align:center}
.filters{background:#fff;padding:10px;display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px}
select,input,label{padding:8px;font-size:14px}
.catalog{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;padding:12px}
.card{background:#fff;padding:10px;border-radius:6px}
.card img{width:100%;height:150px;object-fit:contain}
.price{font-weight:bold;margin-top:6px}
.stock{font-size:13px;color:#555}
.mode{margin-top:6px}
</style>
</head>
<body>

<header>
<h2>Каталог шин</h2>
<div class="mode">
<button onclick="setMode('retail')">Розница</button>
<button onclick="setMode('opt')">Опт</button>
</div>
</header>

<div class="filters">
<select id="size"><option value="">Размер</option></select>
<select id="season"><option value="">Сезон</option></select>
<select id="studs"><option value="">Шипы</option></select>
<select id="brand"><option value="">Бренд</option></select>
<input id="search" placeholder="Поиск по названию">
<label><input type="checkbox" id="inStock"> В наличии</label>
</div>

<div class="catalog" id="catalog"></div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRllTq080YSSI7EgOmGa0XqlhLPxKpomN26jhacDriuVsYPMdJhLM1blqR5Z5FiBvUOjHrdQujXS67q/pub?output=csv";
let mode = "retail";
let data = [];

function setMode(m){ mode=m; render(); }

fetch(CSV_URL)
.then(r=>r.text())
.then(t=>{
 const rows = t.split("\n").slice(1);
 rows.forEach(r=>{
  const c = r.split(",");
  if(c.length < 16) return;
  data.push({
   stock:c[3].trim(),
   opt:c[5].trim(),
   retail:c[7].trim(),
   size:c[10].trim(),
   season:c[11].trim(),
   studs:c[12].trim(),
   name:c[13].trim(),
   brand:c[14].trim(),
   photo:c[15].trim()
  });
 });
 initFilters();
 render();
});

function initFilters(){
 ["size","season","studs","brand"].forEach(id=>{
  const set=[...new Set(data.map(d=>d[id]).filter(Boolean))].sort();
  const sel=document.getElementById(id);
  set.forEach(v=>sel.innerHTML+=`<option value="${v}">${v}</option>`);
  sel.onchange=render;
 });
 document.getElementById("search").oninput=render;
 document.getElementById("inStock").onchange=render;
}

function render(){
 const catalog = document.getElementById("catalog");
 catalog.innerHTML="";
 data.filter(d=>{
  if(document.getElementById("size").value && d.size!==document.getElementById("size").value) return false;
  if(document.getElementById("season").value && d.season!==document.getElementById("season").value) return false;
  if(document.getElementById("studs").value && d.studs!==document.getElementById("studs").value) return false;
  if(document.getElementById("brand").value && d.brand!==document.getElementById("brand").value) return false;
  if(document.getElementById("search").value && !d.name.toLowerCase().includes(document.getElementById("search").value.toLowerCase())) return false;
  if(document.getElementById("inStock").checked && (!d.stock || d.stock=="0")) return false;
  return true;
 }).forEach(d=>{
  catalog.innerHTML+=`
   <div class="card">
    <img src="${d.photo}">
    <div>${d.name}</div>
    <div class="stock">Остаток: ${d.stock||"—"}</div>
    <div class="price">${mode==="opt"?d.opt:d.retail} ₸</div>
   </div>`;
 });
}
</script>
</body>
</html>
